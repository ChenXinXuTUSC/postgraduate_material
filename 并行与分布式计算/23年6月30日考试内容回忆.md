# 23年6月30日考试内容回忆

今年是6.25交论文，6.30考试，复习时间上还是有点紧的。

## 选择题 (多个空、不定项选择)

1. 给定几个硬件，例如 PC、通用寄存器、栈等，问切换线程会保存哪个硬件的信息（大概这个意思，不确定）。
2. 给 cache 的几个措施，问哪些可以提升命中率、降低一级 cache 命中时延、降低一级cache 缺失时延。
3. 问 crossbar 拓扑结构的设备数与节点间的跳数。
4. 顺序执行的流水线不会出现什么相关的问题，给定一些措施，问涉及哪些相关。
* A. 结构相关
* B. WAW 相关
* C. RAW 相关
* D. WAR 相关
* E. 控制相关
5. 给定一些技术，选并行级别，哪些是 ILP，哪些是 TLP，哪些是 DLP。

## 简答题

6. 影响 cache 有 4 个 "C"，即 compulsory, capacity, conflict, coherence，请解释。
7. 一个产品的完成需要经过工序 A 和工序 B，其中每个工人每小时可以完成 4 个 A，或者 10 个 B。现在有 12 个工人，问如何分配做工序 A 和 B 的工人，使得生产这件产品的吞吐量最大（工人在被分配了之后，只能做这一道工序，不能再调整跨工序）？以及你设计的这个分配方案，一个小时内生产的产品数量是多少。
8. 给定交换机、机柜、节点的网络互联结构（有点像隔壁云计算的fat tree结构图），问这个结构对于 MapReduce 中 Map 节点的分配方式、以及 GFS 中 chunk server 的分配方式有什么影响（大概试问这个结构对 MapReduce 和 GFS 的影响，具体问题不确定）。
9. 标记-清除回收算法中，写栅栏是为了当标记的对象发生变化时，JVM 对这些对象进行额外的处理。请举一个例子解释为什么需要写栅栏。
10. 访问显存的延迟代价很高，GPU 如何解决延迟问题？在 GPU 编程中应该采用怎样的编程模式。

## 代码题

11. 给了一个 MPI 程序，写程序输出（简单的send和recv，读懂代码即可）。大概是 rank 0 send 一个 10，然后rank 1 和 2 各自 recv 和 send 一次，最后 rank 3 recv 一次。
12. 给了一段代码（大致如下），其中``read()``需要 1 ms，``write()``需要 1 ms，``f(i)``需要 ``i`` ms。
```c
int a[128], s[128];
read();
for (int i = 1; i <= 128; i++) {
    s[i] = f(i) + a[i];
}
write();
```
* 根据代码画任务图，算串行时间，最大加速比。
* 2 处理器，2 线程下，静态调度下的加速比。其中静态调度是指，其中一个线程完成[1, 64]，另一个线程完成[65, 128]。
* 2 处理器，2 线程下，动态调度下的加速比。其中动态调度是指，把 128 个任务分为 [1, 32], [33, 64], [65, 96], [97, 128]四个任务组，动态分配线程去执行这些任务组，任务组的完成不一定要按照任务组递增的顺序。

## 计算题

13. 给定一个多级 cache 及其访问延迟，其中命中一级的概率为 98%，命中二级的概率为 99%，命中三级的概率为 99.5%，访问主存的延迟为 200ms。
* 求一级缓存采用组相联映射的行长（这里根据容量、关联度求出来，不难，但是数据忘了）
* 求平均访问延迟。

| cache级别 | 容量/关联度 | 访问延迟 |
| :-----:| :-----: | :----: |
| 一级 | 忘了 | 4ms |
| 二级 | 忘了 | 20ms |
| 三级 | 忘了 | 44ms |

14. 给了一段详细的基础知识和一段指令，其中有一个 branch 指令。这道题需要结合五段流水线和它给的背景一起回答，主打理解和运用。
* 填流水线表格。
* 求最后一个指令的写回是在第几个周期。
* 如果用一位分支预测器，求准确率。